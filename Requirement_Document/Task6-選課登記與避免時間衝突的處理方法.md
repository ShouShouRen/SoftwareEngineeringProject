# 專案需求規格說明書：選課登記與衝突避免系統

**文件版本：** V1.0
**文件日期：** 2025/11/29
**專案作者：** 楊立安, B1243023

---

## 1. 系統說明 (System Description)

### 1.1 系統目的與目標
* **目的：** 本系統旨在解決學生在選課過程中可能遇到的**名額衝突、時間衝突和選課資格不符**等問題，確保選課流程的順利和資料的準確性。
* **目標：** 透過建立選課登記功能，達成以下目標：
    1.  [目標 1：] 確保學生能**順利、準確地將課程加入個人課表**。
    2.  [目標 2：] 系統能**自動檢查並有效防止**選課的時間衝突和學分上限超額。

### 1.2 系統範圍
本專案將涵蓋：
* **選課/退選** 的介面動作與後端交易邏輯。
* **選課名額** 的即時檢查與更新。
* **多條件的選課資格檢查**（包含時間衝突、先修條件、學分上限）。

但不包括：
* 課程資料的建立與修改（屬於教務處管理範圍）。

### 1.3 使用者類型與特徵
| 類型 | 描述 | 主要職責/權限 |
| :--- | :--- | :--- |
| **學生 (Student)** | 系統的主要使用者 | 點選課程進行選課登記或取消已選課程。 |
| **授課老師 (Instructor)** | 關注選課名單準確性 | 登入系統查看其課程的選課名單。 |
| **教務處/系所** | 關注選課規則和限制 | 關注選課屬性、先修條件、學分上限的控制。 |

---

## 2. 初步系統架構 (High-Level System Architecture)

本系統的核心在於**交易處理 (Transaction Processing)** 和**衝突檢查邏輯 (Conflict Logic)**，以保證數據一致性。

### 2.1 系統元件概覽

#### 2.1.1 呈現層 (Presentation Layer)
* **技術：** [請填寫，例如：HTML/CSS]
* **職責：** 在課程列表和「我的課表」頁面提供**清晰且易於點擊的「選課」/「退選」按鈕**。

#### 2.1.2 應用/邏輯層 (Application/Logic Layer)
* **技術：** [請填寫，例如：Java/Spring Boot]
* **職責：** 執行所有業務邏輯：
    1.  **時間衝突判斷**：核心邏輯，比對新課時間與既有課表重疊性。
    2.  **選課資格檢查**：檢查額滿、先修條件、學分上限等。
    3.  **交易處理**：將資料儲存 (Enrollment Table 寫入/刪除) 與名額處理 (Course Table +/- 1) 納入單一資料庫交易 (Transaction)，確保資料一致性。

#### 2.1.3 資料層 (Data Layer)
* **技術：** [請填寫，例如：PostgreSQL]
* **職責：**
    1.  **選課紀錄表：** 儲存學生 ID 與課程 ID 的配對。
    2.  **課程資料表：** 需支援剩餘名額的即時更新（減 1 或加 1）。

---

## 3. 功能需求 (Functional Requirements)

功能需求定義了系統在選課流程中**必須提供的功能**。

### 3.1 選課登記流程 (Task 1 & 3)
| ID | 描述 (功能) | 優先級 (高/中/低) | 需求來源 |
| :--- | :--- | :--- | :--- |
| FR-S6.1 | **選課按鈕介面** | 高 | 在每門課程旁設置一個清晰且易於點擊的「選課」按鈕。 |
| FR-S6.2 | **選課前置檢查** | 高 | 點擊後，後端需立即檢查：課程是否額滿、是否符合選課資格（例如年級、先修條件）。 |
| FR-S6.3 | **選課資料寫入** | 高 | 通過所有檢查後，將新的「學生 ID + 課程 ID」紀錄寫入選課紀錄表。 |
| FR-S6.4 | **名額立即減 1** | 高 | 成功寫入紀錄後，立即將該課程的剩餘名額減 1。 |
| FR-S6.5 | **結果確認與導向** | 高 | 顯示「選課成功」訊息，並將學生導向或刷新「我的課表」頁面。 |

### 3.2 時間衝突檢查與處理 (Task 2)
| ID | 描述 (功能) | 優先級 (高/中/低) | 需求來源 |
| :--- | :--- | :--- | :--- |
| FR-S6.6 | **既有課表取出** | 高 | 在選課儲存動作前，系統必須取出學生既有課表的所有課程時間。 |
| FR-S6.7 | **衝突判斷** | 高 | 將新選課程的上課時間與既有課表中的每門課時間進行重疊比對，需支援**跨日期**（例如單雙週）的檢查。 |
| FR-S6.8 | **衝突中止與提示** | 高 | 如果發現任何重疊，**立即中止選課**，並顯示**明確的錯誤訊息**（指出衝突的課程名稱和時間）。 |

### 3.3 取消已選課程 (Task 4)
| ID | 描述 (功能) | 優先級 (高/中/低) | 需求來源 |
| :--- | :--- | :--- | :--- |
| FR-S6.9 | **退選按鈕** | 高 | 在「我的課表」中已選課程旁設置「退選」或「取消選課」按鈕。 |
| FR-S6.10 | **選課紀錄刪除** | 高 | 點擊後，將該筆選課紀錄從選課紀錄表中刪除。 |
| FR-S6.11 | **名額立即加 1** | 高 | 紀錄刪除後，立即將該課程的剩餘名額加 1。 |

---

## 4. 非功能需求 (Non-Functional Requirements)

非功能需求定義了系統在選課交易上的品質屬性。

### 4.1 效能需求 (Performance)
* **高併發控制：** 系統必須能在高併發測試下（例如 N+1 個學生同時選 N 名額的課程），正確執行**名額上限限制 (上限保護)**，保證名額不會超賣。

### 4.2 準確性與可靠性 (Accuracy & Reliability)
* **資料一致性：** 選課/退選過程中，「選課紀錄表」的變動與「課程資料表」的名額更新必須是原子操作（成功則皆成功，失敗則皆失敗）。
* **選課名單準確性：** 授課老師在系統中查看的選課名單人數，必須與資料庫中的實際登記人數**完全一致**。
* **學分上限控制：** 系統必須在學生嘗試選課前檢查其**總學分上限**，並在超額時阻止選課。
